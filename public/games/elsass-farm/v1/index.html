<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Elsass Farm</title>
    
    <link rel="stylesheet" href="style.css">
    
    <!-- 1. LIBRAIRIES -->
    <script src="https://cdn.jsdelivr.net/npm/p5@1.11.4/lib/p5.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/p5@1.11.4/lib/addons/p5.sound.min.js"></script>
    <script src="https://p5play.org/v3/planck.min.js"></script>
    <script src="https://p5play.org/v3/p5play.js"></script>

    <!-- 2. SYSTEME -->
    <script>
        window.DyadGame = { id: 'elsass-farm-v1', version: 'v1' };
    </script>
    <script src="../../system/system.js"></script>

    <!-- 3. JEU -->
    <script src="config.js"></script>
    <script src="main.js"></script>
    <script src="sketch.js"></script>

    <script>
        // Mappage Ic√¥nes (Simplifi√© pour l'instant)
        const ZONE_ICONS = {
            'N_W': '‚õè', // Mine
            'N_C': '‚õ∞', // Montagne
            'N_E': 'üå≤', // For√™t
            'C_W': 'üèô', // Ville
            'C_C': 'üèö', // Ferme Principale (Maison)
            'C_E': 'üåä', // Riviere
            'S_W': 'üêä', // Marais
            'S_C': 'üåæ', // Champs Sud
            'S_E': 'üèñ'  // Plage
        };

        function toggleMenu() {
            const el = document.getElementById('menu-modal');
            el.classList.toggle('active');
        }
        
        function toggleMap() {
            const el = document.getElementById('map-modal');
            el.classList.toggle('active');
            if (el.classList.contains('active')) {
                renderMinimap();
            }
        }

        function toggleFullscreen() {
            if(window.GameSystem && window.GameSystem.Display) {
                window.GameSystem.Display.toggleFullscreen();
            }
            toggleMenu();
        }

        function renderMinimap() {
            const grid = document.getElementById('minimap-grid');
            grid.innerHTML = ''; // Nettoyage
            const currentZoneId = window.ElsassFarm.state.currentZoneId;

            Config.zones.forEach(zone => {
                const tile = document.createElement('div');
                tile.className = 'minimap-tile';
                tile.style.backgroundColor = zone.bgColor;
                tile.setAttribute('data-zone-id', zone.id);

                if (zone.id === currentZoneId) {
                    tile.classList.add('current');
                }

                // Contenu
                tile.innerHTML = `
                    <span class="minimap-icon">${ZONE_ICONS[zone.id] || '‚ùì'}</span>
                    <span>${zone.name}</span>
                `;

                // Logique de clic (T√©l√©portation)
                tile.onclick = () => {
                    if (zone.id !== currentZoneId) {
                        // Simuler la transition (Fondu noir 0.2s)
                        document.body.style.transition = 'background-color 0.2s';
                        document.body.style.backgroundColor = 'black';
                        
                        setTimeout(() => {
                            // La fonction changeZone est dans sketch.js, mais on peut la rendre globale si besoin
                            // Pour l'instant, on simule juste le changement d'√©tat et on ferme le modal
                            window.ElsassFarm.state.currentZoneId = zone.id;
                            toggleMap();
                            
                            // R√©initialiser la couleur de fond du body apr√®s la transition
                            document.body.style.backgroundColor = '#111';
                            document.body.style.transition = 'none';
                            
                            // Forcer le moteur p5.js √† redessiner la nouvelle zone
                            if (window.redraw) window.redraw(); 
                        }, 200);
                    }
                };

                grid.appendChild(tile);
            });
        }
    </script>
</head>
<body>
    <!-- UI Layer -->
    <div id="ui-layer">
        <div class="hud-bar">
            <div class="hud-group">
                <span>‚ö° <span id="val-energy">100</span></span>
                <span>üí∞ <span id="val-gold">0</span></span>
            </div>
            <div class="hud-group">
                <span>üåÖ J<span id="val-day">1</span> <span id="val-time">6:00</span></span>
            </div>
            <div class="hud-group">
                <button class="hud-btn" onclick="toggleMap()">üó∫Ô∏è MAP</button>
                <button class="hud-btn" onclick="toggleMenu()">‚â° MENU</button>
            </div>
        </div>
        
        <!-- Menu Principal Modal -->
        <div id="menu-modal" class="modal-overlay" onclick="if(event.target.id === 'menu-modal') toggleMenu()">
            <div class="modal-content">
                <h3>PAUSE</h3>
                <div class="menu-list">
                    <button class="hud-btn" onclick="toggleFullscreen()">‚õ∂ Plein √âcran</button>
                    <button class="hud-btn" onclick="console.log('Save')">üíæ Sauvegarder</button>
                    <button class="hud-btn" onclick="toggleMenu()">Reprendre</button>
                </div>
            </div>
        </div>

        <!-- Mini-Map Modal -->
        <div id="map-modal" class="modal-overlay" onclick="if(event.target.id === 'map-modal') toggleMap()">
            <div class="modal-content">
                <h3>Carte du Monde (3x3)</h3>
                <div id="minimap-grid" class="minimap-grid">
                    <!-- Tiles g√©n√©r√©es par JS -->
                </div>
            </div>
        </div>
    </div>
</body>
</html>